<!DOCTYPE html>
<html>
<head>
	<title>Mi cuenta</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">
</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top col-xs-12">
		<div class="container-fluid">
			<div class="navbar-header">
				<a href="indexLogin.html" class="navbar-brand">Tienda Online</a>
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navHeaderCollapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="collapse navbar-collapse" id="navHeaderCollapse">
				<ul class="nav navbar-nav ">
					<li><a href="indexLogin.html">Inicio</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#" id="carritoDrop" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-shopping-cart"></span> Carrito <span class="badge" id="badgeCart">0</span></a>
						<div class="dropdown-menu" id="carrito">
							<div class="panel panel-success">
								<div class="panel-heading">
									<div class="row">
										<div class="col-xs-3">No de Prod</div>
										<div class="col-xs-3">Producto</div>
										<div class="col-xs-3">Precio</div>
									</div>
								</div>
								<div class="panel-body" id="carrito_productos"></div>
							</div>
						</div>
					</li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" id="nombreLogin"><span class="glyphicon glyphicon-user"></span> Mi Cuenta</a>
						<ul class="dropdown-menu">
							<li><a href="account.html">Mi cuenta</a></li>
							<li><a href="">Historial de compras</a></li>
							<li><a href="">Salir</a></li>
						</ul>
					</li>					
				</ul>				
			</div>
		</div>		
	</nav>
	<section class="container-fluid">
		<p><br/></p>
		<p><br/></p>
		<p><br/></p>
		<div class="col-xs-3" id="sideBar">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#sideBarAccount">
					<span class="glyphicon glyphicon-plus"></span>
					
				</button>
			</div>
			<div class="nav nav-pills nav-stacked" id="sideBarAccount">
				<li><a href="account.html" >Mi cuenta</a></li>
				<li class="active"><a href="#">Informacion</a></li>
				<li><a href="#">Cupones</a></li>
			</div>
		</div>
		<div class="col-xs-6">			
			<div id="resultadoCuenta">
                  
            </div>
		  	<form action="#" method="POST" id="formularioLogin">
          			<div class="form-group">
          				<label for="nombre">Nombre</label>
          				<input type="text" name="nombre" id="nombre" class="form-control"/>	
          			</div>
          			<div class="form-group">
          				<label for="lastname">Apellidos</label>
          				<input type="text" name="apellidos" id="apellidos" class="form-control"/>	
          			</div>
          			<div class="form-group">
          				<label for="email">Correo</label>
          				<input type="text" name="correo" id="correo" class="form-control"/>
          			</div>
          			<div class="form-group">
          				<label for="fech_naci">Fecha de Nacimiento (YYYY-MM-DD)</label>
          				<input type="text" name="fech_naci" id="fech_naci" class="form-control"/>
          			</div>
          			<div class="form-group">
          				<label for="cp">Codigo Postal</label>
          				<input type="text" name="cp" id="cp" class="form-control"/>
          			</div>
          			<div class="form-group">
          				<label for="direccion">Direccion</label>
          				<input type="text" name="direccion" id="direccion" class="form-control"/>
          			</div>
          			<div class="form-group" >
          				<label for="telefono">Telefono</label>
          				<input type="text" name="telefono" id="telefono" class="form-control"/>
          				<!--<input type="button" value="+" onClick="addInput('telefono','txt');">-->
          			</div>
          			<div class="form-group">
          				<label for="password">Password</label>
          				<input type="password" name="password" id="password" class="form-control"/>
          			</div>

          			<div class="form-group">
          				<button type="submit" class="btn btn-primary">Modificar datos</button>
          			</div>
          			
          	</form>      
		</div>

	</section>
	<footer class="container-fluid navbar-default">
			<div class="col-xs-3" id="lista-footer">
				<div class="navbar-header">
					<ul  class="nav navbar-nav">
						<li>INFORMACION</li>
					</ul>
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#footerCollapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse" id="footerCollapse">
					<ul id="lista-footer" class="nav navbar-nav">
						<li><a href="#">Sobre nosotros</a></li>
						<li><a href="#">Trabaja con nosotros</a></li>
						<li><a href="#">Politicas de uso</a></li>
					</ul>
				</div>
			</div>
			<div class="col-xs-3" id="lista-footer">
				<div class="navbar-header">
					<ul  class="nav navbar-nav">
						<li>SERVICIO AL CLIENTE</li>
					</ul>
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#footerCollapse2">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse" id="footerCollapse2">
					<ul id="lista-footer" class="nav navbar-nav">
						<li><a href="#">Preguntas Frecuentes</a></li>
						<li><a href="#">Formas de pago</a></li>
						<li><a href="#">Terminos y condiciones</a></li>
					</ul>
				</div>
			</div>
			<div class="col-xs-3" id="lista-footer">
				<div class="navbar-header">
					<ul  class="nav navbar-nav">
						<li>REDES SOCIALES</li>
					</ul>
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#footerCollapse3">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse" id="footerCollapse3">
					<ul id="lista-footer" class="nav navbar-nav">
						<li><a href="#">Facebook</a></li>
						<li><a href="#">Twitter</a></li>
						<li><a href="#">Instagram</a></li>
					</ul>
				</div>
			</div>
	</footer>
	<script src="js/jquery-3.1.1.min.js"></script>
	<script src="bootstrap/js/bootstrap.js"></script>
	<script src="vendor/js/jquery-3.2.0.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			prodCarrito();
			login();
			traerDatos();

			function traerDatos(){
				$.ajax({
					type 	 	: 'GET',
					url   		: 'php/index.php?ctrl=usuarios&act=mostrar&r=json',
					dataType 	: 'json',
					success  	: function(json){
						
                    $('#nombre').val(json[0].Nombre);
                    $('#password').val(json[0].Password);
                    $('#conPassword').val(json[0].Password);
                    $('#fech_naci').val(json[0].FechaNacimiento);
                    $('#correo').val(json[0].Correo);
                    $('#cp').val(json[0].CP);
                    $('#apellidos').val(json[0].Apellidos);
                    $('#direccion').val(json[0].Direccion);
                    $('#telefono').val(json[0].Telefono1);
						}
					});
				}
		

			function prodCarrito(){
				$.ajax({
					type: 'GET',
					url: 'php/index.php/?ctrl=carrito&act=badge&r=json',
					dataType: 'json',
					success: function(json){
						$('#badgeCart').text(json);
						
					}
				});
			}

			function login(){
				$.ajax({
					type: 'GET',
					url: 'php/index.php/?ctrl=usuarios&act=usuarioLogin',
					dataType: 'json',
					success: function(json){
						if (json == false) {
							location.href = "index.html";
						}else{
							var login = document.getElementById('nombreLogin');
							login.innerHTML = json;
						}
					}
				});
			}
		});

		$('#carritoDrop').click(function(event){
			event.preventDefault();
			console.log("json");
			$.ajax({
				type 		: 'GET',
				url 		: 'php/index.php?ctrl=carrito&act=listar&r=json',
				dataType 	: 'json',
				success 	: function(json){
					$('#carrito_productos').empty();
					for(i=0;i<json.length;i++){
						var div = document.getElementById('carrito_productos');
						
						var divRow = document.createElement('div');
						var divPrecio = document.createElement('div');
						var divNombre = document.createElement('div');
						var divNo = document.createElement('div');
						var txtNombre = document.createTextNode(json[i].NombreProductoCart);
						var txtPrecio = document.createTextNode('$'+json[i].PrecioCarrito);

						divRow.setAttribute('class', 'row');
						divNombre.setAttribute('class', 'col-xs-3');
						divPrecio.setAttribute('class', 'col-xs-3');
						divNo.setAttribute('class', 'col-xs-3');
						var cont = i + 1;
						//divNo.appendChild(cont);
						divNo.innerHTML = cont;
						//divNo.innerHTML = cont;
						//divNo.innerHTML = cont;
						divNombre.appendChild(txtNombre);
						divPrecio.appendChild(txtPrecio);

						divRow.appendChild(divNo);
						divRow.appendChild(divNombre);
						divRow.appendChild(divPrecio);

						div.appendChild(divRow);
						
					}
					$('#badgeCart').text(cont);
				}
			});
		});

	$( "form" ).on( "submit", function( event ) {
        event.preventDefault();
        var dom = $(this).serialize();
        $.ajax({
          type: 'POST',
          data: dom,
          url:  'php/index.php?ctrl=usuarios&act=modificar',
          dataType: 'json',
          success: function(json){
            $('#resultadoCuenta').empty();
            var resultado = document.getElementById('resultadoCuenta');
            if (json == true) {

              var div = document.createElement('div');
              div.setAttribute('class','alert alert-success');
              
              var a = document.createElement('a');
              a.setAttribute('class','close');
              a.setAttribute('data-dismiss','alert');
              a.setAttribute('aria-label','close');
              a.innerHTML = '&times;';
              var p = document.createElement('p');
              p.innerHTML = "La cuenta fue modificada con exito";
              div.appendChild(a);
              div.appendChild(p);
              resultado.appendChild(div);

            }else{
              var div = document.createElement('div');
              div.setAttribute('class','alert-warning');
              div.setAttribute('role','alert');
              
              var a = document.createElement('a');
              a.setAttribute('class','close');
              a.setAttribute('data-dismiss','alert');
              a.setAttribute('aria-label','close');
              a.innerHTML = '&times;';
              var p = document.createElement('p');
              p.innerHTML = "Hubo un error en la informacion, corrobore los datos";
              div.appendChild(a);
              div.appendChild(p);
              resultado.appendChild(div);
            }
            $('html, body').animate({scrollTop:0}, 'slow'); 
          return false;
          }
        })
      });

	</script>
</body>
</html>
